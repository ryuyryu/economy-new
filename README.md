
# economy-new
# 今やっていること
キャラ＆マップ実装中

実際のスタートページは `public/index.html` です。ルートの `index.html` はこのページへリダイレクトします。
# 🧠 コンサルタント経済シミュレーションゲーム（開発中）

本プロジェクトは、プレイヤーが「コンサルタント」として企業や金融機関を支援する、経済シミュレーション型ブラウザゲームです。  
現実の経済変動や経営課題をもとに、分析・提案・戦略構築のスキルを磨くことができます。

---

## 🎯 実装予定機能一覧

### 🎮 ゲーム基本システム
- プレイヤーはコンサルタントとなり、企業・銀行にアドバイスを提供
- 経営課題の依頼を受け、提案と実行によって評価される
- 評価に応じて報酬・評判が上がり、上位案件に挑戦可能

### 📊 経済シミュレーション要素
- 仮想経済（物価・金利・為替・政策）が動的に変化
- 市場環境に応じて戦略を最適化する必要がある
- 提案が企業の成長・衰退にリアルタイムで影響

### 📑 案件・クライアントシステム
- 業種・規模・依頼内容が異なる多様な案件を用意
- クライアントとの会話から課題を特定し、仮説構築
- 案件成功により「信頼度」や「経験値」が上昇

### 🛠️ 分析・提案フェーズ
- 分析ツール（財務 / マーケ / 組織 / AI など）を選択
- 提案内容を資料としてまとめ、成果に応じてスコア決定
- 成否によってクライアントの未来が分岐

### 🌐 UI/UX技術（使用予定）
- フロントエンド：React / Tailwind CSS / JavaScript
- 構成：SPA（シングルページアプリケーション）
- 対応環境：PC / スマートフォン（予定）

---

## 📌 開発状況

このリポジトリは開発中です。  
今後以下のようなアップデートを予定しています：

- [ ] トップ画面・企業選択画面の実装
- [ ] 案件データの設計と表示ロジック
- [ ] クライアント会話ロジックの追加
- [ ] 提案画面のUI構築
- [ ] 仮想経済データの動的変化処理

## 使い方
まず以下のコマンドを実行し、画像素材を展開してください。

```bash
npm run unpack
```

これにより `public/images/sprites` フォルダに画像がまとめて展開されます。

ブラウザで `public/index.html` を開き、画面をタップするとゲームがスタートします。
ゲーム画面では5〜7秒ごとにターンが進み、上部のステータスがリアルタイムに更新されます。
右上の「☰」ボタンでメニューを開閉でき、まれに発生するイベントは画面右上にトースト表示されます。

マップ上では矢印キーでキャラクターを移動できます。
カメラは常にプレイヤーを中央に捉えるため、移動に応じてスクロールします。

今回の更新でマップ生成ロジックを一新しました。道路・芝生・アスファルトなど
地面系タイルだけを不規則に配置し、中央には小さな広場を設けています。
読み込み時に使う画像は必要分だけを manifest から取得するため、
表示されないトラブルを抑えられます。

### React 版について
スタート画面 (`index.html`) では React を利用した `start_screen_react.js` が読み込まれます。
今回、ゲーム画面も React で試せるよう `game_screen_react.html` と `game_screen_react.js` を追加しました。
React 版スタート画面からはこちらのファイルに遷移します。
従来のプレーンな実装 (`game_screen.html`) も残してあるので、用途に応じて使い分けてください。

### 経済指数ダッシュボード
`game_screen_react.html` では CPI・失業率・政策金利・GDP 成長率をヘッダーに常時表示します。
その他の指標は右上の「☰」ボタンから開くサイドドロワーに一覧表示されます。
サイドドロワーは画面右側から縦長に展開され、右下の「戻る」ボタンで閉じることができます。
CPI のグラフ表示は廃止しました。スマホでも見やすいシンプルなデザインなので、気軽に指標の変化をチェックできます。

指標カードを開くと、過去の推移を示す小さな折れ線グラフ（スパークライン）が表示されます。
履歴は `MAX_HISTORY`(30) 件まで保存され、新しいデータが追加されると古い値から順に削除されます。
各カードではスパークラインを左側に配置し、右側にその指数の意味を解説する「使い方メモ」を表示します。
使い方メモのエリアは角丸のボックスで、内側に影を付けた凹んだデザインです。スパークラインとの境界には縦の仕切り線が入り、メモ部分にはHTMLを利用した箇条書きなども記述できます。
スパークラインはカード幅の約1/3に収まるよう縮小され、横:縦=3:1 の比率で描画されるため、表示がはみ出す心配はありません。
初心者でも数値の内容を理解しやすくなっています。
さらに各カードでは、その指標が経済に与える代表的な影響も箇条書きで紹介しています。
今回の更新で、カード下部に他の指標との**相関係数**が表示され、
政策変更やイベントが指標へ与える影響を説明する段落も追加されました。

使い方メモには次のような情報も盛り込むことで、戦略判断がしやすくなります。

- **相関・傾向の可視化**：他の指標とどの程度連動しているかを、小さな相関図やトレンド矢印で表示します。例えば CPI と政策金利の推移を並べて比較し、金利政策が物価に与える影響を直感的に理解できます。
- **政策・イベントの影響**：`updateEconomy()` を利用したシミュレーション結果をもとに、「政策変更」や「景気ショック」などのイベントが指数に与える影響をカード内で解説します。これにより、ゲーム内で取るべき行動の指針が明確になります。

サイドドロワーには主人公のスキル強化メニューも用意しました。商談力・計算力・運の3つを好きなタイミングでレベルアップできます。

### 各経済指数が経済に与える影響

各指標はそれぞれ経済活動に密接に関わります。CPIの上昇は物価高騰から購買力を低下させ、消費を抑制します。一方、適度なインフレは投資を促し景気を刺激します。失業率が高まると所得減少から消費が落ち込み、企業の売上も悪化します。政策金利は資金調達コストを左右し、引き上げれば景気を冷やす効果があります。GDP成長率は国全体の生産力を示し、長期的な成長トレンドが雇用や税収に大きく影響します。為替レートが急変すると輸出入の採算が変わり、企業収益や物価に波及します。長期金利が上昇すれば住宅投資が鈍り、企業は設備投資を見送ります。消費者信頼感の悪化は財布の紐を固くし、景気循環を下押しします。財政赤字拡大は将来増税の不安を招きます。

#### 経済シミュレーションの更新処理

`public/game_screen_react.js` には `updateEconomy(prevStats, factors)` 関数を実装しました。
需要・供給・政策金利といった要因値 (`factors`) をもとに、CPI や失業率、為替レートなどを計算します。
ゲームループではこれらの要因値を `useState` で管理し、毎ターン少しずつ変化させつつ `updateEconomy()` を呼び出しています。
その結果が `MAX_HISTORY` 分だけ履歴に追加され、画面上の数値とスパークラインに反映されます。

変更後のスクリプトを利用する場合は次の手順でテストしてください。

```bash
npm install
npm test
```

### 新しいスパークラインカード例

`public/economic_card.html` をブラウザで開くと、Chart.js と React を組み合わせた簡易的な
指標カードのサンプルを確認できます。`EconomicCard.jsx` は `SparkChart.jsx` を利用して
折れ線グラフを表示するコンポーネントです。ラベルや数値を自由に差し替えられるので、
自分のデータで試してみてください。
デザインは ECOBOX と統一されたダークテーマに変更しました。


## 🧪 テスト実行方法

テストには **Node.js と npm** が必要です。リポジトリをクローンした直後は依存パッケージがないので、必ず最初に `npm install` を実行してから `npm test` を行ってください。

```bash
npm install  # 依存パッケージのインストール
npm test     # Jest でテストを実行
```

## 🔔 お知らせ一覧機能

`notifications.html` を開くと、React で作られた ECOBOX 画面が表示されます。
画面左側に通知一覧、右側に選択中の通知詳細が表示されます。Tailwind CSS を利用してシンプルにデザインしています。

### お知らせ画面の使い方

1. `notifications.html` を開くと通知の一覧が表示されます。
2. 項目をクリックすると右側に詳細が展開され、同時に既読になります。
3. 閉じるボタンで詳細パネルを閉じることができます。
4. **スマホから利用している場合は、通知をタップした時点で詳細が全画面に拡大表示されます。PC版では従来どおりの幅で表示されます。**

### キャラクター強化カード

`character_card.html` を開くと、ECOBOX と同じダーク系デザインのカードが画面いっぱいに表示されます。中央には人物を表すアイコンがあり、左右に強化項目を段違いに配置しています。右上の「✕」ボタンで前のページへ戻れるシンプルな画面です。

## 🌆 都市マップ素材

ゲーム内マップで利用する画像パーツは Kenney 氏の素材を使用します。
これらは **CC0 ライセンス** で公開されており、公式サイト [Kenney](https://www.kenney.nl/) から入手できます。
ライセンス文書は `public/images/city-kit/License.txt` など各フォルダに配置してあります。
画像素材そのものは展開後にすべて `public/images/sprites` フォルダへまとめられるため、
旧来使用していた `material` `material2` ディレクトリは利用しません。
下記の ZIP ファイルを配置したうえでスクリプトを実行すると、
すべての画像が `sprites` ディレクトリに展開されます。

```
public/images/
├─ kenney_city-kit-commercial_20.zip
└─ kenney_roguelike-modern-city.zip
```
サイズが大きいため、2 段階に分けて解凍するスクリプトを用意しています。

以下のコマンドを実行してください。

```bash
npm run unpack
```

展開後、`public/tileManifest.js` で各画像を参照できるようになります。

さらに以下のコマンドを実行すると、`tileManifest.js` と `spriteInfo.js` が自動生成されます。

```bash
npm run generate-manifest
```

主なディレクトリ構成例:

```
images/
└─ sprites/
```

### sprites ディレクトリの主なタイル

| ファイル名 | 内容 | 使用用途 |
|------------|------|----------|
| `tile_0001.png` | アスファルト | 地面（ベース） |
| `tile_0012.png` | 道路（横） | 横方向道路 |
| `tile_0025.png` | 建物の壁 | 壁・構造物 |
| `tile_0033.png` | 芝生 | 公園・緑地帯 |
| `tile_0040.png` | 横断歩道 | 歩行者用通路 |

### 建物プレビュー画像

| ファイル名 | 内容 | 使用用途 |
|------------|------|----------|
| `building-a.png` | 建物A | マップ用建物 |
| `building-b.png` | 建物B | マップ用建物 |
| `building-c.png` | 建物C | マップ用建物 |
| `building-d.png` | 建物D | マップ用建物 |

| `detail-parasol-a.png` | 傘付きパラソル | キャラクター装飾 |

### 素材プレビュー

以下は `public/images/sprites` に含まれる代表的なタイルの一部です。画像は縮小表示されます。

<p>
  <img src="public/images/sprites/tile_0001.png" width="64" alt="tile_0001" />
  <img src="public/images/sprites/tile_0012.png" width="64" alt="tile_0012" />
  <img src="public/images/sprites/tile_0025.png" width="64" alt="tile_0025" />
  <img src="public/images/sprites/tile_0033.png" width="64" alt="tile_0033" />
  <img src="public/images/sprites/tile_0040.png" width="64" alt="tile_0040" />
  <img src="public/images/sprites/building-a.png" width="64" alt="building-a" />
  <img src="public/images/sprites/building-b.png" width="64" alt="building-b" />
</p>

### spriteInfo.js について

`public/spriteInfo.js` には各スプライトの日本語説明をまとめています。キーは `tileManifest.js` と同じ名前を使っているため、マップ生成時に参照できます。

```javascript
// 例
const spriteInfo = {
  asphalt: { file: 'images/sprites/tile_0001.png', desc: 'アスファルト舗装' }
};
```

新しい画像を追加したら、次のコマンドを実行するだけで `tileManifest.js` と `spriteInfo.js` が再生成されます。

```bash
npm run generate-manifest
```

このコマンドを実行すると `desc` にはファイル名から作成した簡単な日本語説明が自動で入ります。例えば次のように変換されます。

- `tile_0001.png` → **タイル 0001**
- `detail-parasol-a.png` → **パラソル A**

英単語を日本語に置き換え、ハイフンやアンダースコアはスペースとして扱います。1文字だけのアルファベットは大文字で残るので、一覧を見ただけで内容がわかります。

その後、`game_screen.html` などで `spriteInfo.js` が読み込まれているか確認してください。

これにより、マップ生成時に使用タイルの一覧がコンソールへ表示され、選択ミスを防げます。

### 自作マップの読み込み

`public/custom_map_sample.js` を参考に、`window.customMapData` という2次元配列を
定義したファイルを用意します。`game_screen.html` に追加で読み込むことで、ランダム
生成ではなくこの配列を使ってマップを描画できます。

```html
<!-- 例: 自作マップを読み込む -->
<script src="custom_map_sample.js"></script>
<script src="map_canvas.js"></script>
```

配列内には `tileManifest.js` に記載されているキー名をそのまま書きます。自由にタイル
を並べられるので、思い通りのマップを作成できます。

### ゲームスクリーンのタイル数

デフォルトではマップの横幅・縦幅ともに **30 タイル** で構成されます。
`map_canvas.js` では画面の横幅を 30 で割った値を 1 タイルのサイズとして計算するため、
表示領域（ヘッダーを除いたキャンバス部分）に収まる縦方向のタイル数は次の式で求められます。

```
floor((画面の高さ - ヘッダーの高さ) / (画面の横幅 / 30))
```

この値が 30 未満の場合はスクロールして表示しますが、画面が十分に広ければマップ全体
(30 × 30 = **900 タイル**) を一度に描画できます。スマホ画面 (幅 375px 程度) では
おおむねタイルサイズが 12～13px となり、縦方向にも 30 タイル以上配置できるため、
多くの環境でマップ全体が収まります。


---

## 🙋‍♂️ Contributors

- **企画・構成・監修**：江橋　山毛
- **コーディング・実装**：山毛
- **アドバイザー・ChatGPT**：江橋　codex OpenAI GPT-4o Claude Gemini じる
 
---

## 📜 License
This project is licensed under the MIT License - see the [LICENSE](./LICENSE) file for details.



